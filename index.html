<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªåŸå¸‚æ°‘è‰ºæœ¯å¤œæ ¡ - â€œå¸ˆå¸¦å¾’â€æ–°äººåŸ¹å…»è®¡åˆ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Warm Neutrals (Stone, Slate, Amber) -->
    <!-- Application Structure Plan: å‡çº§ä¸ºåŒ…å«æŒä¹…åŒ–å­˜å‚¨çš„ä»ªè¡¨æ¿ã€‚ç»“æ„æ‰©å±•ä¸ºä¸ƒå¤§æ¿å—ï¼š1.æ¦‚è§ˆ, 2.è¯¦æƒ…, 3.å¯¼å¸ˆè¯„ä¼°(æ•°æ®è¾“å…¥), 4.å¾’å¼Ÿåé¦ˆ(æ•°æ®è¾“å…¥), 5.åœ¨çº¿ç»Ÿè®¡(æ•°æ®æ˜¾ç¤º), 6.æ¿€åŠ±æœºåˆ¶, 7.æ•°æ®ç®¡ç†å…¥å£ã€‚æ ¸å¿ƒæ˜¯å¼•å…¥Firestoreï¼Œå°†è¯„ä¼°å’Œåé¦ˆè¡¨å•ä»è®¡ç®—å·¥å…·è½¬å˜ä¸ºæ•°æ®æ”¶é›†å…¥å£ï¼Œåœ¨çº¿ç»Ÿè®¡æ¿å—åˆ™æˆä¸ºå®æ—¶çš„æ•°æ®å¯è§†åŒ–ä¸­å¿ƒï¼Œå®ç°äº†ä»é™æ€åˆ°åŠ¨æ€ã€ä»ä¸ªäººä½¿ç”¨åˆ°å›¢é˜Ÿåä½œçš„è½¬å˜ã€‚ -->
    <!-- Visualization & Content Choices: æ¦‚è§ˆ->å¡ç‰‡; è¯¦æƒ…->æ‰‹é£ç´; è¯„ä¼°->äº¤äº’è¡¨å•+JS->Firestoreå†™å…¥; åé¦ˆ->æ˜Ÿçº§+JS->Firestoreå†™å…¥; ç»Ÿè®¡->æŒ‡æ ‡å¡+æ¡å½¢å›¾(å²—ä½å¯¹æ¯”)+é›·è¾¾å›¾(å¯¼å¸ˆæ•ˆæœ)+JS->Firestoreè¯»å–ä¸èšåˆ; æ¿€åŠ±->é™æ€æ¡å½¢å›¾ã€‚æ­¤é€‰æ‹©ç¡®ä¿äº†æ•°æ®æµçš„å®Œæ•´é—­ç¯ï¼šæ”¶é›†->å­˜å‚¨->åˆ†æ->å±•ç¤ºã€‚ç¡®è®¤æœªä½¿ç”¨SVGåŠMermaid JSã€‚ -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8f7f4; color: #334155; }
        html { scroll-behavior: smooth; }
        .nav-link { transition: color 0.3s, border-bottom-color 0.3s; }
        .nav-link:hover, .nav-link.active { color: #d97706; border-bottom-color: #d97706; }
        .tab-btn { transition: all 0.3s; }
        .tab-btn.active { background-color: #d97706; color: #ffffff; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .score-item { cursor: pointer; transition: all 0.2s ease-in-out; }
        .score-item:hover { transform: scale(1.1); background-color: #f59e0b; color: white; }
        .score-item.selected { background-color: #d97706; color: white; font-weight: bold; transform: scale(1.1); }
        .feedback-star { cursor: pointer; color: #d1d5db; transition: color 0.2s, transform 0.2s; }
        .feedback-star:hover { transform: scale(1.2); }
        .feedback-stars:hover .feedback-star, .feedback-star.selected { color: #f59e0b; }
        .feedback-stars .feedback-star:hover ~ .feedback-star { color: #d1d5db; }
        .chart-placeholder { display: flex; flex-direction:column; align-items: center; justify-content: center; height: 100%; color: #9ca3af; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #d97706; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Custom Modal */
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 100; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-backdrop.visible { opacity: 1; visibility: visible; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 90%; width: 400px; transform: scale(0.95); transition: transform 0.3s; }
        .modal-backdrop.visible .modal-content { transform: scale(1); }
        @media print {
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area { position: absolute; left: 0; top: 0; width: 100%; }
            header, #actions-bar, #apprentice-feedback, #statistics, #rewards, footer, #data-management { display: none; }
        }
    </style>
</head>
<body class="bg-stone-50 text-slate-700">

    <header class="bg-white/80 backdrop-blur-sm sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-xl font-bold text-amber-700">å¸ˆå¸¦å¾’è®¡åˆ’</div>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#overview" class="nav-link text-slate-600 border-b-2 border-transparent pb-1">è®¡åˆ’æ¦‚è§ˆ</a>
                <a href="#details" class="nav-link text-slate-600 border-b-2 border-transparent pb-1">è®¡åˆ’è¯¦æƒ…</a>
                <a href="#evaluation" class="nav-link text-slate-600 border-b-2 border-transparent pb-1">å¯¼å¸ˆè¯„ä¼°</a>
                <a href="#apprentice-feedback" class="nav-link text-slate-600 border-b-2 border-transparent pb-1">å¾’å¼Ÿåé¦ˆ</a>
                <a href="#statistics" class="nav-link text-slate-600 border-b-2 border-transparent pb-1">åœ¨çº¿ç»Ÿè®¡</a>
                <a href="#rewards" class="nav-link text-slate-600 border-b-2 border-transparent pb-1">æ¿€åŠ±æœºåˆ¶</a>
            </div>
            <div class="md:hidden">
                <select id="mobile-nav" class="bg-white border border-stone-300 rounded-md px-3 py-2 text-slate-700">
                    <option value="#overview">è®¡åˆ’æ¦‚è§ˆ</option>
                    <option value="#details">è®¡åˆ’è¯¦æƒ…</option>
                    <option value="#evaluation">å¯¼å¸ˆè¯„ä¼°</option>
                    <option value="#apprentice-feedback">å¾’å¼Ÿåé¦ˆ</option>
                    <option value="#statistics">åœ¨çº¿ç»Ÿè®¡</option>
                    <option value="#rewards">æ¿€åŠ±æœºåˆ¶</option>
                </select>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">

        <!-- Section 1: Overview -->
        <section id="overview" class="mb-20 scroll-mt-20">
            <h1 class="text-4xl font-bold text-center mb-4 text-amber-800">å…³äºåœ¨å…¨æ ¡èŒƒå›´å†…å¼€å±•â€œå¸ˆå¸¦å¾’â€æ–°äººåŸ¹å…»è®¡åˆ’çš„é€šçŸ¥</h1>
            <p class="text-center text-slate-500 max-w-3xl mx-auto mb-12">ä¸ºä¿ƒè¿›æ–°å‘˜å·¥å¿«é€Ÿæˆé•¿ï¼Œå¸®åŠ©ä»–ä»¬å°½å¿«ç†Ÿæ‚‰ä¸šåŠ¡ã€èå…¥é›†ä½“ï¼ŒåŒæ—¶å……åˆ†å‘æŒ¥èµ„æ·±å‘˜å·¥çš„ä¸“ä¸šä¼˜åŠ¿ä¸å¼•é¢†ä½œç”¨ï¼Œæ­å»ºæ•™å­¦ç›¸é•¿ã€äº’ä¿ƒå…±è¿›çš„å¹³å°ï¼Œç‰¹å¯åŠ¨æœ¬è®¡åˆ’ã€‚</p>
            <div class="grid md:grid-cols-3 gap-8 text-center">
                <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-xl transition-shadow duration-300"><div class="text-5xl mb-4 text-amber-600">ğŸ¯</div><h3 class="text-2xl font-bold mb-2">è®¡åˆ’å®—æ—¨</h3><p class="text-slate-500">é€šè¿‡â€œä¸€å¯¹ä¸€â€æˆ–â€œäºŒå¯¹ä¸€â€çš„ä¼ ã€å¸®ã€å¸¦æ¨¡å¼ï¼Œç³»ç»Ÿæ€§å¼•å¯¼æ–°å‘˜å·¥æŒæ¡æŠ€èƒ½ã€ç†Ÿæ‚‰æµç¨‹ã€ä¼ æ‰¿æ–‡åŒ–ï¼Œæ‰“é€ é«˜ç´ è´¨ä¸“ä¸šäººæ‰é˜Ÿä¼ã€‚</p></div>
                <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-xl transition-shadow duration-300"><div class="text-5xl mb-4 text-amber-600">ğŸ‘¥</div><h3 class="text-2xl font-bold mb-2">å‚ä¸å¯¹è±¡</h3><p class="text-slate-500"><strong>å¯¼å¸ˆï¼š</strong>ä¸šåŠ¡ç²¾æ¹›ã€è´£ä»»å¿ƒå¼ºçš„èµ„æ·±å‘˜å·¥ã€‚<br><strong>å¾’å¼Ÿï¼š</strong>è¿‘æœŸå…¥èŒæˆ‘æ ¡çš„å…¨ä½“æ–°å‘˜å·¥ã€‚</p></div>
                <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-xl transition-shadow duration-300"><div class="text-5xl mb-4 text-amber-600">ğŸ†</div><h3 class="text-2xl font-bold mb-2">æ ¸å¿ƒæ¿€åŠ±</h3><p class="text-slate-500">è®¾ç«‹â€œå®ä¹ ç‰¹ç§å…µâ€ã€â€œé‡‘ç‰Œå¯¼å¸ˆâ€åŠâ€œå›­ä¸å¥–â€ç­‰è£èª‰å’Œç°é‡‘å¥–åŠ±ï¼Œå…¨é¢æ¿€åŠ±å¸ˆå¾’å…±åŒè¿›æ­¥ã€‚</p></div>
            </div>
        </section>

        <!-- Section 2: Details -->
        <section id="details" class="mb-20 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-10">è®¡åˆ’å®æ–½ç»†åˆ™</h2>
            <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-8">
                <div id="accordion-mentor"><h3 class="text-2xl font-semibold mb-4 text-amber-700">å¯¼å¸ˆèŒè´£</h3><div class="space-y-4"><div class="bg-white rounded-lg shadow-sm"><button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold">æ€æƒ³å¼•å¯¼<span class="transform transition-transform duration-300">â–¼</span></button><div class="accordion-content max-h-0 overflow-hidden transition-max-height duration-500 ease-in-out px-5"><p class="pb-5 text-slate-600">å…³å¿ƒæ–°å‘˜å·¥çš„æ€æƒ³åŠ¨æ€ï¼Œå¼•å¯¼å…¶æ ‘ç«‹æ­£ç¡®çš„èŒä¸šè§‚ä¸ä»·å€¼è§‚ï¼Œä¼ æ‰¿æˆ‘æ ¡â€œçˆ±æ°‘ã€æ•¬æ°‘ã€æƒ æ°‘ã€åˆ©æ°‘â€çš„åŠå­¦ç†å¿µã€‚</p></div></div><div class="bg-white rounded-lg shadow-sm"><button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold">ä¸šåŠ¡æŒ‡å¯¼<span class="transform transition-transform duration-300">â–¼</span></button><div class="accordion-content max-h-0 overflow-hidden transition-max-height duration-500 ease-in-out px-5"><p class="pb-5 text-slate-600">åˆ¶å®šä¸ªæ€§åŒ–çš„å¸¦æ•™è®¡åˆ’ï¼Œæ˜ç¡®å­¦ä¹ ç›®æ ‡ä¸ä»»åŠ¡ï¼Œå®šæœŸè®²æˆä¸šåŠ¡çŸ¥è¯†ã€æ“ä½œæŠ€èƒ½åŠå·¥ä½œæµç¨‹ã€‚</p></div></div><div class="bg-white rounded-lg shadow-sm"><button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold">è¿‡ç¨‹è€ƒè¯„<span class="transform transition-transform duration-300">â–¼</span></button><div class="accordion-content max-h-0 overflow-hidden transition-max-height duration-500 ease-in-out px-5"><p class="pb-5 text-slate-600">æ¯æœˆ15æ—¥åŠ30æ—¥å¯¹æ–°å‘˜å·¥çš„æˆé•¿è¿›åº¦ã€ä»»åŠ¡å®Œæˆè´¨é‡åŠç»¼åˆè¡¨ç°è¿›è¡Œä¸€æ¬¡å®¢è§‚ã€å…¬æ­£çš„è€ƒè¯„ä¸æ‰“åˆ†ï¼Œå¹¶åŠæ—¶ç»™äºˆåé¦ˆä¸æŒ‡å¯¼ã€‚</p></div></div></div></div>
                <div id="accordion-apprentice"><h3 class="text-2xl font-semibold mb-4 text-amber-700">å¾’å¼ŸèŒè´£</h3><div class="space-y-4"><div class="bg-white rounded-lg shadow-sm"><button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold">è™šå¿ƒå­¦ä¹ <span class="transform transition-transform duration-300">â–¼</span></button><div class="accordion-content max-h-0 overflow-hidden transition-max-height duration-500 ease-in-out px-5"><p class="pb-5 text-slate-600">å°Šé‡å¯¼å¸ˆï¼Œä¸»åŠ¨è¯·æ•™ï¼Œå‹¤äºæ€è€ƒï¼Œè®¤çœŸå®Œæˆå¯¼å¸ˆå®‰æ’çš„å„é¡¹å­¦ä¹ ä»»åŠ¡ä¸å·¥ä½œã€‚</p></div></div><div class="bg-white rounded-lg shadow-sm"><button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold">å®šæœŸåé¦ˆ<span class="transform transition-transform duration-300">â–¼</span></button><div class="accordion-content max-h-0 overflow-hidden transition-max-height duration-500 ease-in-out px-5"><p class="pb-5 text-slate-600">æ¯æœˆ15æ—¥åŠ30æ—¥å¯¹å¯¼å¸ˆçš„æŒ‡å¯¼æ–¹å¼ã€å¸®æ‰¶æ•ˆæœåŠå¸¦æ•™æŠ•å…¥åº¦è¿›è¡Œä¸€æ¬¡åŒ¿åçš„ä¹¦é¢æµ‹è¯„ï¼Œä»¥ä¿ƒè¿›æ•™å­¦æ–¹æ³•çš„ä¼˜åŒ–ã€‚</p></div></div><div class="bg-white rounded-lg shadow-sm"><button class="accordion-header w-full flex justify-between items-center p-5 text-left font-semibold">æ€»ç»“æå‡<span class="transform transition-transform duration-300">â–¼</span></button><div class="accordion-content max-h-0 overflow-hidden transition-max-height duration-500 ease-in-out px-5"><p class="pb-5 text-slate-600">å®šæœŸå¤ç›˜ä¸ªäººæˆé•¿ï¼Œæ€»ç»“ç»éªŒä¸ä¸è¶³ï¼Œä¸æ–­æå‡è‡ªèº«ä¸“ä¸šèƒ½åŠ›ä¸ç»¼åˆç´ å…»ã€‚</p></div></div></div></div>
            </div>
        </section>

        <!-- Section 3: Evaluation -->
        <section id="evaluation" class="mb-20 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-2">å¯¼å¸ˆåœ¨çº¿è¯„ä¼°</h2>
            <p class="text-center text-slate-500 max-w-3xl mx-auto mb-10">è¯·å¯¼å¸ˆé€‰æ‹©å¾’å¼Ÿå¯¹åº”çš„å²—ä½ï¼Œå¡«å†™ä¿¡æ¯å¹¶åœ¨çº¿æ‰“åˆ†ã€‚ç‚¹å‡»â€œæäº¤è¯„ä¼°â€åæ•°æ®å°†è¢«è®°å½•ç”¨äºç»Ÿè®¡ã€‚</p>
            <div class="flex justify-center mb-8 space-x-2 md:space-x-4"><button class="tab-btn active px-4 py-2 md:px-6 md:py-3 rounded-lg font-semibold bg-white text-slate-600" data-tab="planning">ä¼åˆ’å²—</button><button class="tab-btn px-4 py-2 md:px-6 md:py-3 rounded-lg font-semibold bg-white text-slate-600" data-tab="academic">æ•™åŠ¡å²—</button><button class="tab-btn px-4 py-2 md:px-6 md:py-3 rounded-lg font-semibold bg-white text-slate-600" data-tab="streaming">ç›´æ’­å²—</button></div>
            <div id="printable-area" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg"><div id="evaluation-forms"></div></div>
            <div id="actions-bar" class="mt-8 flex flex-wrap justify-center gap-4"><button id="submit-eval-btn" class="px-8 py-3 bg-amber-600 text-white font-bold rounded-lg hover:bg-amber-700 transition-colors">æäº¤è¯„ä¼°</button><button id="clear-eval-btn" class="px-8 py-3 bg-slate-500 text-white font-bold rounded-lg hover:bg-slate-600 transition-colors">æ¸…ç©ºè¡¨å•</button><button id="print-btn" class="px-8 py-3 bg-slate-500 text-white font-bold rounded-lg hover:bg-slate-600 transition-colors">æ‰“å°è¡¨å•</button></div>
        </section>
        
        <!-- Section 4: Apprentice Feedback -->
        <section id="apprentice-feedback" class="mb-20 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-2">å¾’å¼ŸåŒ¿ååé¦ˆ</h2>
            <p class="text-center text-slate-500 max-w-3xl mx-auto mb-10">ä¸ºå¸®åŠ©å¯¼å¸ˆæ”¹è¿›ï¼Œè¯·å¾’å¼Ÿå¯¹æœ¬è½®å¸¦æ•™è¿›è¡ŒåŒ¿åè¯„ä»·ã€‚æ‚¨çš„åé¦ˆè‡³å…³é‡è¦ï¼Œå¹¶å°†ä¸¥æ ¼ä¿å¯†å­˜å…¥åå°ã€‚</p>
            <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg"><div id="feedback-form-container"><div class="space-y-6"><div><label class="font-semibold block mb-2">1. å¯¼å¸ˆçš„æŒ‡å¯¼æ–¹å¼æ¸…æ™°æ˜“æ‡‚å—ï¼Ÿ</label><div class="feedback-stars flex space-x-2 text-3xl" data-rating-id="method"><span class="feedback-star" data-value="1">â˜…</span><span class="feedback-star" data-value="2">â˜…</span><span class="feedback-star" data-value="3">â˜…</span><span class="feedback-star" data-value="4">â˜…</span><span class="feedback-star" data-value="5">â˜…</span></div></div><div><label class="font-semibold block mb-2">2. å¯¼å¸ˆæä¾›çš„å¸®åŠ©å’Œæ”¯æŒæœ‰æ•ˆå—ï¼Ÿ</label><div class="feedback-stars flex space-x-2 text-3xl" data-rating-id="effect"><span class="feedback-star" data-value="1">â˜…</span><span class="feedback-star" data-value="2">â˜…</span><span class="feedback-star" data-value="3">â˜…</span><span class="feedback-star" data-value="4">â˜…</span><span class="feedback-star" data-value="5">â˜…</span></div></div><div><label class="font-semibold block mb-2">3. å¯¼å¸ˆåœ¨å¸¦æ•™è¿‡ç¨‹ä¸­çš„æŠ•å…¥åº¦å¦‚ä½•ï¼Ÿ</label><div class="feedback-stars flex space-x-2 text-3xl" data-rating-id="engagement"><span class="feedback-star" data-value="1">â˜…</span><span class="feedback-star" data-value="2">â˜…</span><span class="feedback-star" data-value="3">â˜…</span><span class="feedback-star" data-value="4">â˜…</span><span class="feedback-star" data-value="5">â˜…</span></div></div><div><label class="font-semibold block mb-2">4. å…¶ä»–å…·ä½“å»ºè®®æˆ–æ„Ÿè°¢çš„è¯ï¼š</label><textarea id="feedback-comment" class="w-full p-2 border border-stone-300 rounded-md h-28" placeholder="å¯ä»¥è¯´è¯´å“ªäº›æ–¹é¢åšå¾—ç‰¹åˆ«å¥½ï¼Œæˆ–è€…å“ªäº›åœ°æ–¹å¯ä»¥æ”¹è¿›..."></textarea></div></div><div class="mt-8 text-center"><button id="submit-feedback-btn" class="px-10 py-3 bg-amber-600 text-white font-bold rounded-lg hover:bg-amber-700 transition-colors disabled:bg-stone-300">æäº¤åé¦ˆ</button></div></div><div id="feedback-success-msg" class="hidden text-center py-10"><div class="text-6xl mb-4">âœ…</div><h3 class="text-2xl font-bold text-green-600">æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼</h3><p class="text-slate-500 mt-2">æ‚¨çš„å®è´µæ„è§å·²æˆåŠŸæäº¤ã€‚</p></div></div>
        </section>
        
        <!-- Section 5: Statistics -->
        <section id="statistics" class="mb-20 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-2">åœ¨çº¿å®æ—¶ç»Ÿè®¡</h2>
            <p class="text-center text-slate-500 max-w-3xl mx-auto mb-10">æ‰€æœ‰å·²æäº¤çš„è¯„ä¼°ä¸åé¦ˆæ•°æ®å°†åœ¨è¿™é‡Œå®æ—¶æ±‡æ€»ä¸åˆ†æã€‚</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-lg text-center"><h3 class="text-lg font-semibold text-slate-500">è¯„ä¼°æ€»æ•°</h3><p id="eval-total-count" class="text-5xl font-bold text-amber-600">0</p></div>
                <div class="bg-white p-6 rounded-xl shadow-lg text-center"><h3 class="text-lg font-semibold text-slate-500">åé¦ˆæ€»æ•°</h3><p id="feedback-total-count" class="text-5xl font-bold text-amber-600">0</p></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="text-xl font-bold text-center mb-4">å„å²—ä½å¹³å‡åˆ†</h3><div class="chart-container relative h-80 w-full max-w-2xl mx-auto"><canvas id="avgScoreByPosChart"></canvas><div id="avgScoreByPosChart-placeholder" class="chart-placeholder"><div class="loader"></div><span>ç­‰å¾…æ•°æ®...</span></div></div></div>
                <div class="bg-white p-6 rounded-xl shadow-lg"><h3 class="text-xl font-bold text-center mb-4">å¯¼å¸ˆå¸¦æ•™æ•ˆæœåˆ†æ</h3><div class="chart-container relative h-80 w-full max-w-md mx-auto"><canvas id="feedbackRadarChart"></canvas><div id="feedbackRadarChart-placeholder" class="chart-placeholder"><div class="loader"></div><span>ç­‰å¾…æ•°æ®...</span></div></div></div>
            </div>
        </section>

        <!-- Section 6: Rewards -->
        <section id="rewards" class="mb-12 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-2">è€ƒè¯„ä¸æ¿€åŠ±æœºåˆ¶</h2>
            <p class="text-center text-slate-500 max-w-3xl mx-auto mb-10">é€šè¿‡å…¬æ­£çš„è€ƒè¯„ï¼Œæˆ‘ä»¬è®¾ç«‹äº†ä¸°åšçš„å¥–åŠ±ï¼Œä»¥è¡¨å½°è¡¨ç°ä¼˜å¼‚çš„å¸ˆå¾’ã€‚</p>
            <div class="bg-white p-8 rounded-xl shadow-lg"><div class="chart-container relative h-64 md:h-80 w-full max-w-3xl mx-auto"><canvas id="rewardsChart"></canvas></div><div class="mt-6 text-sm text-center text-slate-500"><p><span class="font-bold">æ³¨ï¼š</span>â€œå›­ä¸æ—¥å¸¸å¸¦è®­å¥–åŠ±â€é‡‘é¢æ ¹æ®å¾’å¼Ÿå¯¹å¯¼å¸ˆçš„æµ‹è¯„å¾—åˆ†ï¼Œåˆ†ä¸º500å…ƒï¼ˆä¼˜ï¼‰å’Œ300å…ƒï¼ˆè‰¯ï¼‰ä¸¤ä¸ªç­‰çº§ã€‚</p></div></div>
        </section>

        <!-- Section 7: Data Management -->
        <section id="data-management" class="mb-12 scroll-mt-20">
            <h2 class="text-3xl font-bold text-center mb-2">æ•°æ®ç®¡ç†</h2>
            <p class="text-center text-slate-500 max-w-3xl mx-auto mb-10">æ‰€æœ‰æäº¤çš„æ•°æ®éƒ½ä¼šè¢«å®‰å…¨åœ°å­˜å‚¨åœ¨äº‘ç«¯æ•°æ®åº“ä¸­ï¼Œæ‚¨å¯ä»¥éšæ—¶ç™»å½•åå°æŸ¥çœ‹ã€‚</p>
            <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg text-center">
                <h3 class="text-xl font-bold mb-4">å¦‚ä½•æŸ¥çœ‹æ•°æ®ï¼Ÿ</h3>
                <p class="text-slate-600 mb-6">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œç™»å½•æ‚¨çš„Firebaseè´¦æˆ·ï¼Œå³å¯åœ¨ **Firestore Database** ä¸­æ‰¾åˆ°åä¸º `evaluations` å’Œ `feedbacks` çš„æ•°æ®é›†åˆï¼Œæ‰€æœ‰å¡«æŠ¥è®°å½•éƒ½åœ¨å…¶ä¸­ã€‚</p>
                <a href="https://console.firebase.google.com/" target="_blank" class="inline-block px-8 py-3 bg-amber-600 text-white font-bold rounded-lg hover:bg-amber-700 transition-colors">
                    å‰å¾€Firebaseåå°
                </a>
            </div>
        </section>
    </main>

    <footer class="bg-white mt-16"><div class="container mx-auto px-6 py-8 text-center text-slate-500"><p>&copy; 2025 å¤ªåŸå¸‚æ°‘è‰ºæœ¯å¤œæ ¡. All Rights Reserved.</p><p class="text-sm mt-2">ä¸ºå¤ªåŸå¸‚æ°‘çš„è‰ºæœ¯ç”Ÿæ´»è´¡çŒ®åŠ›é‡ã€‚</p></div></footer>

    <!-- Custom Modal for Confirmation -->
    <div id="confirmation-modal" class="modal-backdrop">
        <div class="modal-content">
            <h3 id="modal-title" class="text-xl font-bold mb-4">ç¡®è®¤æ“ä½œ</h3>
            <p id="modal-message" class="text-slate-600 mb-6">æ‚¨ç¡®å®šè¦æäº¤å—ï¼Ÿ</p>
            <div class="flex justify-center gap-4">
                <button id="modal-cancel-btn" class="px-6 py-2 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300">å–æ¶ˆ</button>
                <button id="modal-confirm-btn" class="px-6 py-2 bg-amber-600 text-white font-semibold rounded-lg hover:bg-amber-700">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <script type="module">
        // --- 1. IMPORTS & CONFIGURATION ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // This configuration has been replaced with the one you provided.
        const firebaseConfig = {
            apiKey: "AIzaSyDFCErcTQaOGJWT1Bw-jdYnWurDL-j0mgU",
            authDomain: "project-4323493989447866258.firebaseapp.com",
            projectId: "project-4323493989447866258",
            storageBucket: "project-4323493989447866258.appspot.com",
            messagingSenderId: "720438802358",
            appId: "1:720438802358:web:8fe2241e7c53dc325b7317",
            measurementId: "G-QEEBRSFBQJ"
        };

        // --- 2. FIREBASE INITIALIZATION ---
        let db, auth, appId;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            appId = firebaseConfig.projectId;
        } catch (e) {
            console.error("Firebase initialization error:", e);
            alert("Firebase é…ç½®æ— æ•ˆï¼Œè¯·æ£€æŸ¥æ‚¨ç²˜è´´çš„é…ç½®ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚");
        }

        const EVALUATIONS_COLLECTION = `/artifacts/${appId}/public/data/evaluations`;
        const FEEDBACKS_COLLECTION = `/artifacts/${appId}/public/data/feedbacks`;

        // --- 3. APPLICATION STATE & DATA ---
        const formsData = {
            planning: { title: 'ä¼åˆ’å²—å¾’å¼Ÿè¯„ä¼°è¡¨', criteria: [{ dimension: 'æ€æƒ³æ€åº¦ (20%)', item: '1. å·¥ä½œä¸»åŠ¨æ€§ä¸è´£ä»»å¿ƒï¼šç§¯ææ‰¿æ‹…ä»»åŠ¡ï¼Œå¯¹å­¦æ ¡â€œçˆ±æ°‘ã€æ•¬æ°‘ã€æƒ æ°‘ã€åˆ©æ°‘â€çš„ç†å¿µæœ‰è®¤åŒæ„Ÿã€‚', weight: 0.2, score: 0, id: 1 },{ dimension: '', item: '2. å›¢é˜Ÿåä½œç²¾ç¥ï¼šèƒ½ä¸åŒäº‹æœ‰æ•ˆæ²Ÿé€šï¼Œä¸»åŠ¨åˆ†äº«ï¼Œèå…¥é›†ä½“ã€‚', weight: 0.2, score: 0, id: 2 },{ dimension: 'ä¸“ä¸šèƒ½åŠ› (50%)', item: '3. æ´»åŠ¨ç­–åˆ’èƒ½åŠ›ï¼šèƒ½æå‡ºæœ‰åˆ›æ„çš„æ´»åŠ¨ç‚¹å­ï¼Œå¹¶å½¢æˆé€»è¾‘æ¸…æ™°ã€å¯è½åœ°çš„åˆæ­¥æ–¹æ¡ˆã€‚', weight: 0.5, score: 0, id: 3 },{ dimension: '', item: '4. æ´»åŠ¨è¿è¥ä¸æ‰§è¡Œï¼šèƒ½ç»†è‡´åœ°è·Ÿè¿›æ´»åŠ¨å„ç¯èŠ‚ï¼Œæ¨åŠ¨æµç¨‹é¡ºåˆ©è¿›è¡Œï¼Œå¤„ç†çªå‘é—®é¢˜ã€‚', weight: 0.5, score: 0, id: 4 },{ dimension: '', item: '5. ç­–ç•¥è¯„ä¼°ä¸å¤ç›˜ï¼šèƒ½å¯¹æ´»åŠ¨æ•ˆæœè¿›è¡Œæ•°æ®åˆ†æï¼Œæ€»ç»“ç»éªŒä¸ä¸è¶³ï¼Œæå‡ºæ”¹è¿›å»ºè®®ã€‚', weight: 0.5, score: 0, id: 5 },{ dimension: 'å­¦ä¹ ä¸æˆé•¿ (30%)', item: '6. ä»»åŠ¡å®Œæˆè´¨é‡ï¼šæŒ‰æ—¶ã€æŒ‰è´¨å®Œæˆå¯¼å¸ˆå¸ƒç½®çš„å­¦ä¹ ä¸å·¥ä½œä»»åŠ¡ã€‚', weight: 0.3, score: 0, id: 6 },{ dimension: '', item: '7. å­¦ä¹ ä¸»åŠ¨æ€§ï¼šè™šå¿ƒè¯·æ•™ï¼Œå‹¤äºæ€è€ƒï¼Œèƒ½ä¸¾ä¸€åä¸‰ï¼Œä¸»åŠ¨å¯»æ±‚æå‡ã€‚', weight: 0.3, score: 0, id: 7 }] },
            academic: { title: 'æ•™åŠ¡å²—å¾’å¼Ÿè¯„ä¼°è¡¨', criteria: [{ dimension: 'æ€æƒ³æ€åº¦ (20%)', item: '1. æœåŠ¡æ„è¯†ä¸è´£ä»»å¿ƒï¼šå·¥ä½œè´£ä»»å¿ƒå¼ºï¼ŒæœåŠ¡çƒ­æƒ…å‘¨åˆ°ï¼Œä½“ç°â€œçˆ±æ°‘ã€æ•¬æ°‘ã€æƒ æ°‘ã€åˆ©æ°‘â€çš„ç†å¿µã€‚', weight: 0.2, score: 0, id: 8 },{ dimension: '', item: '2. å›¢é˜Ÿåä½œä¸æ‰§è¡ŒåŠ›ï¼šå°Šé‡å¯¼å¸ˆï¼Œæœä»å·¥ä½œå®‰æ’ï¼Œèƒ½èå…¥å›¢é˜Ÿã€‚', weight: 0.2, score: 0, id: 9 },{ dimension: 'ä¸“ä¸šèƒ½åŠ› (50%)', item: '3. æ ¡åŒºæ¥å¾…ï¼šä»ªå®¹ä»ªè¡¨å¾—ä½“ï¼Œæ¥å¾…å­¦å‘˜/è®¿å®¢ä¸“ä¸šã€è€å¿ƒï¼Œè§£ç­”é—®é¢˜å‡†ç¡®ã€‚', weight: 0.5, score: 0, id: 10 },{ dimension: '', item: '4. æ•™åŠ¡æ“ä½œï¼šè¯¾ç¨‹æ ¸é”€ã€æŠ¥åã€æ’è¯¾ç­‰ç³»ç»Ÿæ“ä½œç†Ÿç»ƒã€å‡†ç¡®æ— è¯¯ã€‚', weight: 0.5, score: 0, id: 11 },{ dimension: '', item: '5. æ²Ÿé€šåè°ƒï¼šä¸å­¦å‘˜ç”µè¯æ²Ÿé€šæ¸…æ™°ã€ä¸å†…å¤–éƒ¨è€å¸ˆå¯¹æ¥é¡ºç•…ã€æœ‰æ•ˆã€‚', weight: 0.5, score: 0, id: 12 },{ dimension: 'å­¦ä¹ ä¸æˆé•¿ (30%)', item: '6. ä»»åŠ¡å®Œæˆè´¨é‡ï¼šä¿è´¨ä¿é‡å®Œæˆæ—¥å¸¸æ•™åŠ¡å·¥ä½œåŠå¯¼å¸ˆäº¤åŠäº‹é¡¹ã€‚', weight: 0.3, score: 0, id: 13 },{ dimension: '', item: '7. å­¦ä¹ ä¸»åŠ¨æ€§ï¼šä¸»åŠ¨å­¦ä¹ ä¸šåŠ¡æµç¨‹ï¼Œé‡åˆ°é—®é¢˜èƒ½åŠæ—¶è¯·æ•™å¹¶è®°å½•ã€‚', weight: 0.3, score: 0, id: 14 }] },
            streaming: { title: 'ç›´æ’­å²—å¾’å¼Ÿè¯„ä¼°è¡¨', criteria: [{ dimension: 'æ€æƒ³æ€åº¦ (20%)', item: '1. ç›´æ’­çƒ­æƒ…ä¸æ•¬ä¸šåº¦ï¼šç›´æ’­æ€åº¦è®¤çœŸï¼Œå¯Œæœ‰æ¿€æƒ…ï¼Œèƒ½ä¼ é€’å­¦æ ¡ç§¯ææ­£é¢çš„å½¢è±¡ã€‚', weight: 0.2, score: 0, id: 15 },{ dimension: '', item: '2. å›¢é˜Ÿåä½œç²¾ç¥ï¼šèƒ½ä¸è¿è¥ã€åŠ©æ’­ç­‰å²—ä½äººå‘˜è‰¯å¥½é…åˆï¼Œå…±åŒå®Œæˆç›´æ’­ç›®æ ‡ã€‚', weight: 0.2, score: 0, id: 16 },{ dimension: 'ä¸“ä¸šèƒ½åŠ› (50%)', item: '3. é•œå¤´è¡¨ç°ä¸äº’åŠ¨ï¼šé•œå¤´æ„Ÿå¼ºï¼Œè¯­è¨€æµç•…ï¼Œä»ªæ€è‡ªç„¶ï¼Œèƒ½ä¸è§‚ä¼—æœ‰æ•ˆäº’åŠ¨ï¼Œè°ƒåŠ¨æ°”æ°›ã€‚', weight: 0.5, score: 0, id: 17 },{ dimension: '', item: '4. è¯¾ç¨‹ä¸äº§å“è®²è§£ï¼šå¯¹æ¨å¹¿çš„è¯¾ç¨‹/äº§å“æ ¸å¿ƒå–ç‚¹ç†Ÿæ‚‰ï¼Œè®²è§£é€»è¾‘æ¸…æ™°ï¼Œå¯Œæœ‰å¸å¼•åŠ›ã€‚', weight: 0.5, score: 0, id: 18 },{ dimension: '', item: '5. ç›´æ’­ç­–åˆ’ä¸å¤ç›˜ï¼šèƒ½å‚ä¸ç›´æ’­è„šæœ¬ç­–åˆ’ï¼Œå¹¶åœ¨æ’­åå¯¹æ•°æ®è¿›è¡Œå¤ç›˜ï¼Œæå‡ºä¼˜åŒ–æƒ³æ³•ã€‚', weight: 0.5, score: 0, id: 19 },{ dimension: 'å­¦ä¹ ä¸æˆé•¿ (30%)', item: '6. ä»»åŠ¡å®Œæˆè´¨é‡ï¼šæŒ‰è¦æ±‚å®Œæˆç›´æ’­åœºæ¬¡ã€æ—¶é•¿åŠå…¶ä»–å‡†å¤‡å·¥ä½œã€‚', weight: 0.3, score: 0, id: 20 },{ dimension: '', item: '7. å­¦ä¹ ä¸»åŠ¨æ€§ï¼šä¸»åŠ¨è§‚æ‘©ä¼˜ç§€ä¸»æ’­ï¼Œè™šå¿ƒæ¥å—æŒ‡å¯¼å¹¶èƒ½å¿«é€Ÿæ”¹è¿›ã€‚', weight: 0.3, score: 0, id: 21 }] }
        };
        let currentTab = 'planning';
        const feedbackState = { method: 0, effect: 0, engagement: 0 };
        let avgScoreChart, feedbackChart;

        // --- 4. FUNCTIONS ---

        function generateFormHTML(tabKey) {
            const data = formsData[tabKey]; let criteriaHTML = ''; let lastDimension = '';
            data.criteria.forEach(c => { let dimensionCell = `<td>${c.dimension}</td>`; if (c.dimension === lastDimension) { dimensionCell = `<td class="border-t"></td>`; } else { lastDimension = c.dimension; }
                criteriaHTML += `<tr class="hover:bg-stone-50">${dimensionCell}<td class="p-3 border-t">${c.item}</td><td class="p-3 border-t"><div class="flex flex-wrap gap-1 justify-center" data-criterion-id="${c.id}">${[...Array(10).keys()].map(i => `<div class="score-item w-8 h-8 flex items-center justify-center rounded-full border border-stone-200">${i + 1}</div>`).join('')}</div></td><td class="p-3 border-t text-center font-bold text-lg text-amber-700" id="score-display-${c.id}">-</td></tr>`;
            });
            return `<h3 class="text-2xl font-bold text-center mb-6" id="form-title">${data.title}</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div><label class="font-semibold block mb-2">å¾’å¼Ÿå§“å:</label><input type="text" aria-label="å¾’å¼Ÿå§“å" class="w-full p-2 border border-stone-300 rounded-md"></div><div><label class="font-semibold block mb-2">å¯¼å¸ˆå§“å:</label><input type="text" aria-label="å¯¼å¸ˆå§“å" class="w-full p-2 border border-stone-300 rounded-md"></div></div><div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead class="bg-stone-100 text-slate-800"><tr><th class="p-3 w-1/6">è¯„ä¼°ç»´åº¦</th><th class="p-3 w-3/6">å…·ä½“è¯„ä¼°é¡¹</th><th class="p-3 w-2/6 text-center">è¯„åˆ† (1-10åˆ†)</th><th class="p-3 w-1/12 text-center">å¾—åˆ†</th></tr></thead><tbody>${criteriaHTML}</tbody><tfoot><tr class="bg-stone-100 font-bold"><td colspan="3" class="p-4 text-right text-xl">æ€»åˆ†:</td><td id="total-score" class="p-4 text-center text-2xl text-amber-800">0.0</td></tr></tfoot></table></div><div class="mt-6"><label class="font-semibold block mb-2">å¯¼å¸ˆè¯„è¯­ä¸æŒ‡å¯¼å»ºè®®:</label><textarea class="w-full p-2 border border-stone-300 rounded-md h-24"></textarea></div>`;
        }

        function calculateTotalScore() {
            const data = formsData[currentTab]; let totalScore = 0; const dimensionScores = { '0.2': [], '0.5': [], '0.3': [] };
            data.criteria.forEach(c => { if(c.score > 0) { dimensionScores[c.weight.toString()].push(c.score); } });
            for (const weight in dimensionScores) { const scores = dimensionScores[weight]; if (scores.length > 0) { const avg = scores.reduce((a, b) => a + b, 0) / scores.length; totalScore += avg * parseFloat(weight); } }
            document.getElementById('total-score').textContent = totalScore.toFixed(1);
        }

        function updateEvaluationForm() {
            document.getElementById('evaluation-forms').innerHTML = generateFormHTML(currentTab);
            formsData[currentTab].criteria.forEach(c => c.score = 0);
            calculateTotalScore();
        }

        function checkFeedbackFormValidity() {
            const isComplete = Object.values(feedbackState).every(rating => rating > 0);
            document.getElementById('submit-feedback-btn').disabled = !isComplete;
        }

        function resetFeedbackForm() {
            Object.keys(feedbackState).forEach(key => feedbackState[key] = 0);
            document.querySelectorAll('.feedback-stars').forEach(c => c.querySelectorAll('.feedback-star').forEach(s => s.classList.remove('selected')));
            document.getElementById('feedback-comment').value = '';
            checkFeedbackFormValidity();
        }
        
        function showModal(title, message, onConfirm) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            const modal = document.getElementById('confirmation-modal');
            modal.classList.add('visible');

            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            const confirmHandler = () => {
                onConfirm();
                hideModal();
                confirmBtn.removeEventListener('click', confirmHandler);
                cancelBtn.removeEventListener('click', cancelHandler);
            };
            const cancelHandler = () => {
                hideModal();
                confirmBtn.removeEventListener('click', confirmHandler);
                cancelBtn.removeEventListener('click', cancelHandler);
            };
            
            confirmBtn.addEventListener('click', confirmHandler);
            cancelBtn.addEventListener('click', cancelHandler);
        }

        function hideModal() {
            document.getElementById('confirmation-modal').classList.remove('visible');
        }

        // --- Chart Functions ---
        function initRewardsChart() {
            const ctx = document.getElementById('rewardsChart').getContext('2d');
            new Chart(ctx, { type: 'bar', data: { labels: ['å®ä¹ ç‰¹ç§å…µ', 'é‡‘ç‰Œå¯¼å¸ˆ', 'å›­ä¸å¥–(ä¼˜)', 'å›­ä¸å¥–(è‰¯)'], datasets: [{ label: 'å¥–åŠ±é‡‘é¢ (å…ƒ)', data: [500, 1000, 500, 300], backgroundColor: ['rgba(245, 158, 11, 0.6)', 'rgba(217, 119, 6, 0.7)', 'rgba(180, 83, 9, 0.6)', 'rgba(146, 64, 14, 0.5)'], borderColor: ['rgba(245, 158, 11, 1)', 'rgba(217, 119, 6, 1)', 'rgba(180, 83, 9, 1)', 'rgba(146, 64, 14, 1)'], borderWidth: 1 }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false }, title: { display: true, text: 'å„é¡¹è®¡åˆ’å¥–åŠ±é‡‘é¢å¯¹æ¯”', font: { size: 18, family: "'Noto Sans SC', sans-serif" }, padding: { top: 10, bottom: 20 } }, tooltip: { callbacks: { label: (context) => ` å¥–åŠ±: ${context.raw} å…ƒ` } } }, scales: { x: { beginAtZero: true, title: { display: true, text: 'é‡‘é¢ (å…ƒ)' } } } }
            });
        }
        
        function initAvgScoreChart() {
            const ctx = document.getElementById('avgScoreByPosChart').getContext('2d');
            avgScoreChart = new Chart(ctx, { type: 'bar', data: { labels: ['ä¼åˆ’å²—', 'æ•™åŠ¡å²—', 'ç›´æ’­å²—'], datasets: [{ label: 'å¹³å‡åˆ†', data: [0, 0, 0], backgroundColor: 'rgba(217, 119, 6, 0.6)', borderColor: 'rgba(217, 119, 6, 1)', borderWidth: 1 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 10 } }, plugins: { legend: { display: false } } }
            });
        }

        function initFeedbackChart() {
            const ctx = document.getElementById('feedbackRadarChart').getContext('2d');
            feedbackChart = new Chart(ctx, { type: 'radar', data: { labels: ['æŒ‡å¯¼æ–¹å¼', 'å¸®æ‰¶æ•ˆæœ', 'æŠ•å…¥åº¦'], datasets: [{ label: 'å¹³å‡è¯„åˆ†', data: [0, 0, 0], backgroundColor: 'rgba(217, 119, 6, 0.2)', borderColor: 'rgba(217, 119, 6, 1)', pointBackgroundColor: 'rgba(217, 119, 6, 1)' }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { beginAtZero: true, max: 5, pointLabels: { font: { size: 14 } } } }, plugins: { legend: { display: false } } }
            });
        }

        // --- 5. EVENT LISTENERS & DATA HANDLING ---
        
        function addEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', () => {
                    currentTab = button.dataset.tab;
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    updateEvaluationForm();
                });
            });

            document.getElementById('evaluation-forms').addEventListener('click', (e) => {
                if (e.target.classList.contains('score-item')) {
                    const scoreItem = e.target;
                    const criterionId = scoreItem.parentElement.dataset.criterionId;
                    const score = parseInt(scoreItem.textContent);
                    const criterion = formsData[currentTab].criteria.find(c => c.id == criterionId);
                    criterion.score = score;
                    document.getElementById(`score-display-${criterionId}`).textContent = score;
                    scoreItem.parentElement.querySelectorAll('.score-item').forEach(el => el.classList.remove('selected'));
                    scoreItem.classList.add('selected');
                    calculateTotalScore();
                }
            });

            document.getElementById('submit-eval-btn').addEventListener('click', () => {
                const form = document.getElementById('printable-area');
                const apprenticeName = form.querySelector('input[aria-label="å¾’å¼Ÿå§“å"]').value;
                const mentorName = form.querySelector('input[aria-label="å¯¼å¸ˆå§“å"]').value;
                if (!apprenticeName || !mentorName) { alert('è¯·å¡«å†™å¾’å¼Ÿå’Œå¯¼å¸ˆçš„å§“åã€‚'); return; }
                
                showModal('ç¡®è®¤æäº¤è¯„ä¼°', 'æ‚¨ç¡®å®šè¦æäº¤è¿™ä»½è¯„ä¼°å—ï¼Ÿæäº¤åå°†è®¡å…¥ç»Ÿè®¡ã€‚', async () => {
                    const totalScore = parseFloat(document.getElementById('total-score').textContent);
                    const comments = form.querySelector('textarea').value;
                    const position = currentTab;
                    try {
                        await addDoc(collection(db, EVALUATIONS_COLLECTION), { apprenticeName, mentorName, position, totalScore, comments, createdAt: serverTimestamp() });
                        alert('è¯„ä¼°å·²æˆåŠŸæäº¤ï¼');
                        updateEvaluationForm();
                    } catch (e) { console.error("Error adding document: ", e); alert('æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜ã€‚'); }
                });
            });
            document.getElementById('clear-eval-btn').addEventListener('click', () => updateEvaluationForm());
            document.getElementById('print-btn').addEventListener('click', () => window.print());

            document.querySelectorAll('.feedback-stars').forEach(container => {
                container.addEventListener('click', (e) => {
                    if (e.target.classList.contains('feedback-star')) {
                        const ratingId = container.dataset.ratingId;
                        const value = parseInt(e.target.dataset.value);
                        feedbackState[ratingId] = value;
                        container.querySelectorAll('.feedback-star').forEach(star => {
                            star.classList.toggle('selected', parseInt(star.dataset.value) <= value);
                        });
                        checkFeedbackFormValidity();
                    }
                });
            });
            document.getElementById('submit-feedback-btn').addEventListener('click', () => {
                showModal('ç¡®è®¤æäº¤åé¦ˆ', 'æ‚¨ç¡®å®šè¦æäº¤è¿™ä»½åŒ¿ååé¦ˆå—ï¼Ÿ', async () => {
                    const comment = document.getElementById('feedback-comment').value;
                    try {
                        await addDoc(collection(db, FEEDBACKS_COLLECTION), { ratings: feedbackState, comment, createdAt: serverTimestamp() });
                        document.getElementById('feedback-form-container').classList.add('hidden');
                        document.getElementById('feedback-success-msg').classList.remove('hidden');
                        setTimeout(() => {
                            document.getElementById('feedback-form-container').classList.remove('hidden');
                            document.getElementById('feedback-success-msg').classList.add('hidden');
                            resetFeedbackForm();
                        }, 3000);
                    } catch (e) { console.error("Error adding document: ", e); alert('æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜ã€‚'); }
                });
            });

            document.querySelectorAll('.accordion-header').forEach(header => { header.addEventListener('click', () => {
                const content = header.nextElementSibling; const icon = header.querySelector('span');
                if (content.style.maxHeight) { content.style.maxHeight = null; icon.style.transform = 'rotate(0deg)'; } 
                else { const parent = header.closest('div[id^="accordion-"]'); parent.querySelectorAll('.accordion-content').forEach(c => c.style.maxHeight = null); parent.querySelectorAll('.accordion-header span').forEach(i => i.style.transform = 'rotate(0deg)'); content.style.maxHeight = content.scrollHeight + "px"; icon.style.transform = 'rotate(180deg)'; }
            }); });

            document.getElementById('mobile-nav').addEventListener('change', function() { document.querySelector(this.value).scrollIntoView(); });
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { navLinks.forEach(link => { link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id); }); document.getElementById('mobile-nav').value = `#${entry.target.id}`; } }); }, { rootMargin: "-50% 0px -50% 0px" });
            sections.forEach(section => observer.observe(section));
        }

        function listenForStatistics() {
            const evalCollectionRef = collection(db, EVALUATIONS_COLLECTION);
            onSnapshot(evalCollectionRef, (snapshot) => {
                const evaluations = snapshot.docs.map(doc => doc.data());
                document.getElementById('eval-total-count').textContent = evaluations.length;
                const placeholder = document.getElementById('avgScoreByPosChart-placeholder');
                if (evaluations.length > 0) {
                    placeholder.style.display = 'none';
                    if (!avgScoreChart) initAvgScoreChart();
                    const scoresByPos = { planning: [], academic: [], streaming: [] };
                    evaluations.forEach(e => { if (scoresByPos[e.position]) { scoresByPos[e.position].push(e.totalScore); } });
                    const avgScores = Object.keys(scoresByPos).map(pos => { const scores = scoresByPos[pos]; return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0; });
                    avgScoreChart.data.datasets[0].data = avgScores;
                    avgScoreChart.update();
                } else { placeholder.style.display = 'flex'; placeholder.innerHTML = `<span>æš‚æ— è¯„ä¼°æ•°æ®</span>`; }
            }, (error) => { console.error("Error listening to evaluations:", error); });

            const feedbackCollectionRef = collection(db, FEEDBACKS_COLLECTION);
            onSnapshot(feedbackCollectionRef, (snapshot) => {
                const feedbacks = snapshot.docs.map(doc => doc.data());
                document.getElementById('feedback-total-count').textContent = feedbacks.length;
                const placeholder = document.getElementById('feedbackRadarChart-placeholder');
                if (feedbacks.length > 0) {
                    placeholder.style.display = 'none';
                    if (!feedbackChart) initFeedbackChart();
                    const totals = { method: 0, effect: 0, engagement: 0 };
                    feedbacks.forEach(f => { totals.method += f.ratings.method; totals.effect += f.ratings.effect; totals.engagement += f.ratings.engagement; });
                    const avgRatings = [ totals.method / feedbacks.length, totals.effect / feedbacks.length, totals.engagement / feedbacks.length ];
                    feedbackChart.data.datasets[0].data = avgRatings;
                    feedbackChart.update();
                } else { placeholder.style.display = 'flex'; placeholder.innerHTML = `<span>æš‚æ— åé¦ˆæ•°æ®</span>`; }
            }, (error) => { console.error("Error listening to feedbacks:", error); });
        }
        
        // --- 6. MAIN EXECUTION ---
        async function main() {
            if (!db) return; // Stop if Firebase didn't initialize
            try {
                await signInAnonymously(auth);
                console.log("Signed in anonymously.");
                addEventListeners();
                updateEvaluationForm();
                checkFeedbackFormValidity();
                listenForStatistics();
                initRewardsChart();
            } catch (error) {
                console.error("Initialization failed:", error);
                alert("åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‚¨çš„Firebaseé…ç½®å’Œç½‘ç»œè¿æ¥ã€‚");
            }
        }

        main();

    </script>
</body>
</html>
